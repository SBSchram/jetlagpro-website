<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Validation Test</title>
    <script src="assets/js/trip-validator.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .valid { background-color: #d4edda; border-color: #c3e6cb; }
        .invalid { background-color: #f8d7da; border-color: #f5c6cb; }
        .legacy { background-color: #fff3cd; border-color: #ffeaa7; }
        .real-travel { background-color: #d1ecf1; border-color: #bee5eb; }
        .survey-fallback { background-color: #e2e3e5; border-color: #d6d8db; }
    </style>
</head>
<body>
    <h1>üß™ Trip Validation Test</h1>
    <p>Testing the centralized trip validation logic with sample data.</p>
    
    <div id="test-results"></div>
    
    <script>
        // Test data representing different scenarios
        const testTrips = [
            {
                id: 'legacy-1',
                description: 'Legacy data (no arrivalTimeZone)',
                data: {
                    originTimezone: 'America/New_York',
                    completionMethod: 'app',
                    surveyCompleted: true
                    // No arrivalTimeZone field
                }
            },
            {
                id: 'real-travel-1',
                description: 'Real travel (different timezones)',
                data: {
                    originTimezone: 'America/New_York',
                    arrivalTimeZone: 'Europe/London',
                    completionMethod: 'app',
                    surveyCompleted: true
                }
            },
            {
                id: 'survey-fallback-1',
                description: 'Survey fallback (same timezone, survey completion)',
                data: {
                    originTimezone: 'America/New_York',
                    arrivalTimeZone: 'America/New_York',
                    completionMethod: 'app_survey',
                    surveyCompleted: true
                }
            },
            {
                id: 'test-data-1',
                description: 'Test data (same timezone, no survey)',
                data: {
                    originTimezone: 'America/New_York',
                    arrivalTimeZone: 'America/New_York',
                    completionMethod: 'app',
                    surveyCompleted: true
                }
            },
            {
                id: 'test-data-2',
                description: 'Test data (same timezone, different completion method)',
                data: {
                    originTimezone: 'America/New_York',
                    arrivalTimeZone: 'America/New_York',
                    completionMethod: 'manual',
                    surveyCompleted: true
                }
            },
            {
                id: 'incomplete-survey',
                description: 'Incomplete survey (should be filtered out)',
                data: {
                    originTimezone: 'America/New_York',
                    arrivalTimeZone: 'Europe/London',
                    completionMethod: 'app',
                    surveyCompleted: false
                }
            }
        ];
        
        function runTests() {
            const container = document.getElementById('test-results');
            let html = '';
            
            testTrips.forEach(trip => {
                const isValid = TripValidator.isValidTrip(trip.data);
                const details = TripValidator.getValidationDetails(trip.data);
                
                let cssClass = 'test-case ';
                if (isValid) {
                    cssClass += details.rule === 'legacy' ? 'legacy' : 
                               details.rule === 'real_travel' ? 'real-travel' : 'survey-fallback';
                } else {
                    cssClass += 'invalid';
                }
                
                html += `<div class="${cssClass}">`;
                html += `<h3>${trip.description}</h3>`;
                html += `<p><strong>Valid:</strong> ${isValid ? '‚úÖ Yes' : '‚ùå No'}</p>`;
                html += `<p><strong>Rule:</strong> ${details.rule}</p>`;
                html += `<p><strong>Reason:</strong> ${details.reason}</p>`;
                html += `<p><strong>Data:</strong> ${JSON.stringify(trip.data, null, 2)}</p>`;
                html += '</div>';
            });
            
            // Test filtering functions
            const allTrips = testTrips.map(t => t.data);
            const validTrips = TripValidator.filterValidTrips(allTrips);
            const invalidTrips = TripValidator.filterInvalidTrips(allTrips);
            const stats = TripValidator.getValidationStats(allTrips);
            const breakdown = TripValidator.getValidationBreakdown(allTrips);
            
            html += '<div class="test-case" style="background-color: #f8f9fa;">';
            html += '<h3>üìä Validation Statistics</h3>';
            html += `<p><strong>Total Trips:</strong> ${stats.total}</p>`;
            html += `<p><strong>Valid Trips:</strong> ${stats.valid} (${stats.validPercentage}%)</p>`;
            html += `<p><strong>Invalid Trips:</strong> ${stats.invalid} (${stats.invalidPercentage}%)</p>`;
            html += '<h4>Breakdown by Rule:</h4>';
            html += `<p>Legacy: ${breakdown.legacy}</p>`;
            html += `<p>Real Travel: ${breakdown.real_travel}</p>`;
            html += `<p>Survey Fallback: ${breakdown.survey_fallback}</p>`;
            html += `<p>Test Data: ${breakdown.test_data}</p>`;
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
