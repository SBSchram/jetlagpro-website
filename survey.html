<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jet Lag Research Survey - JetLagPro</title>
    
    <!-- Aggressive cache busting -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="Help advance chronoacupuncture research by participating in our jet lag survey. Your feedback helps improve jet lag management for travelers worldwide.">
    <meta name="keywords" content="jet lag research, chronoacupuncture survey, travel research, jet lag study">
    <script>
        // Eternal cache busting solution - auto-generates timestamp
        const cacheVersion = Math.floor(Date.now() / 1000);
        document.write('<link rel="stylesheet" href="survey.css?v=' + cacheVersion + '">');
    </script>
    <script src="load-common-head.js"></script>
</head>
<body>
    <div id="main-header"></div>

    <main>
        <section class="hero-simple">
            <div class="container">
                <h1>Jet Lag Research Survey</h1>
                <p class="hero-subtitle">Help advance chronoacupuncture research and improve jet lag management for travelers worldwide.</p>
            </div>
        </section>

        <div class="survey-main-column">
            <section class="survey-intro survey-card">
                <div class="container">
                    <div class="intro-content">
                        <h2>About This Research</h2>
                        <p>JetLagPro is conducting research to evaluate the effectiveness of chronoacupuncture for jet lag management. Your participation helps advance our understanding of this traditional Chinese medicine approach.</p>
                        
                        <div class="research-goals">
                            <h3>Research Goals:</h3>
                            <ul>
                                <li>Evaluate chronoacupuncture effectiveness for jet lag</li>
                                <li>Understand individual variation in treatment response</li>
                                <li>Identify optimal usage patterns for travelers</li>
                                <li>Improve jet lag management for future users</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Survey Preview Section -->
            <section class="survey-preview survey-card">
                <div class="container">
                    <div class="preview-content">
                        <h2>Survey Preview</h2>
                        <p>Below is a preview of the research survey questions. To participate in the actual survey and contribute to our research, you'll need a survey code from the JetLagPro app.</p>
                        
                        <div class="preview-notice">
                            <div class="notice-box">
                                <h4>üî¨ Research Participation</h4>
                                <p>This survey is part of ongoing research into chronoacupuncture for jet lag management. To participate:</p>
                                <ol>
                                    <li>Download the JetLagPro app</li>
                                    <li>Complete a journey in the app</li>
                                    <li>Click "Take Survey" from the Home screen (automatically includes your code)</li>
                                    <li>Complete the survey below</li>
                                </ol>
                                <p><strong>Note:</strong> If you arrived here directly, you'll need to enter your survey code manually.</p>
                            </div>
                        </div>
                        
                        <div class="code-input-section">
                            <label for="surveyCode">Survey Code (Required for Submission):</label>
                            <input type="text" id="surveyCode" placeholder="Enter your survey code (e.g., JLP-XXXXXXXX)" maxlength="12">
                            <button type="button" id="validateCode" class="btn btn-primary">Enable Survey Submission</button>
                        </div>
                        
                        <div id="validationMessage" class="validation-message"></div>
                    </div>
                </div>
            </section>

            <!-- Survey Content (always visible, but submission disabled without code) -->
            <div id="surveyContent" class="survey-layout-container survey-card">

                    <!-- LJLQ-based survey - Single scrollable form -->
                    <div class="survey-content">
                      <h3>Pre-Travel Baseline</h3>
                      <p>Please rate your typical symptoms before this trip:</p>
                      <form id="baselineForm">
                        <div class="symptom-row">
                          <label>Sleep disturbance</label>
                          <div class="scale-container">
                            <input type="range" name="baseline_sleep" min="1" max="5" value="1" class="scale-slider">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Daytime fatigue</label>
                          <div class="scale-container">
                            <input type="range" name="baseline_fatigue" min="1" max="5" value="1" class="scale-slider">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Difficulty concentrating</label>
                          <div class="scale-container">
                            <input type="range" name="baseline_concentration" min="1" max="5" value="1" class="scale-slider">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Irritability</label>
                          <div class="scale-container">
                            <input type="range" name="baseline_irritability" min="1" max="5" value="1" class="scale-slider">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Gastrointestinal issues</label>
                          <div class="scale-container">
                            <input type="range" name="baseline_gi" min="1" max="5" value="1" class="scale-slider">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                      </form>

                      <h3 style="margin-top: 40px;">Post-Travel Assessment</h3>
                      <p>Please rate your <strong>current</strong> symptoms since arriving at your destination:</p>
                      <form id="postForm">
                        <div class="symptom-row">
                          <label>Sleep disturbance</label>
                          <div class="scale-container" style="width: 100%;">
                            <input type="range" name="post_sleep_severity" min="1" max="5" value="1" class="scale-slider" style="width: 100%;">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Daytime fatigue</label>
                          <div class="scale-container" style="width: 100%;">
                            <input type="range" name="post_fatigue_severity" min="1" max="5" value="1" class="scale-slider" style="width: 100%;">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Difficulty concentrating</label>
                          <div class="scale-container" style="width: 100%;">
                            <input type="range" name="post_concentration_severity" min="1" max="5" value="1" class="scale-slider" style="width: 100%;">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Irritability</label>
                          <div class="scale-container" style="width: 100%;">
                            <input type="range" name="post_irritability_severity" min="1" max="5" value="1" class="scale-slider" style="width: 100%;">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                        <div class="symptom-row">
                          <label>Gastrointestinal issues</label>
                          <div class="scale-container" style="width: 100%;">
                            <input type="range" name="post_gi_severity" min="1" max="5" value="1" class="scale-slider" style="width: 100%;">
                            <div class="scale-labels">
                              <span>None</span>
                              <span>Severe</span>
                            </div>
                          </div>
                        </div>
                      </form>

                      <h3 style="margin-top: 40px;">Travel Context</h3>
                      <p>Please provide details about your travel experience and app usage:</p>
                      <form id="contextForm">
                        <div class="context-row">
                          <label>When did your flight land? <span style="color: #e74c3c; font-weight: bold;">*</span></label>
                          <input type="datetime-local" name="flight_landing_time" required>
                          <small style="color: #666; font-size: 0.9em;">Select date and time when your flight arrived (required)</small>
                        </div>
                        <div class="context-row">
                          <label>Destination airport code</label>
                          <input type="text" name="destination" placeholder="e.g., LHR, JFK, LAX" maxlength="3" style="text-transform: uppercase;">
                          <small style="color: #666; font-size: 0.9em;">3-letter airport code (e.g., LHR for London Heathrow)</small>
                        </div>
                        <div class="context-row">
                          <label>Direction of travel</label>
                          <select name="direction">
                            <option value="east">Eastward</option>
                            <option value="west">Westward</option>
                            <option value="both">Both</option>
                            <option value="not_sure">Not sure</option>
                          </select>
                        </div>
                        <div class="context-row">
                          <label>Number of time zones crossed</label>
                          <select name="timezones">
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12+">12+</option>
                          </select>
                        </div>
                        <div class="context-row">
                          <label>Flight duration</label>
                          <select name="flight_duration">
                            <option value="lt6">&lt;6h</option>
                            <option value="6-9">6‚Äì9h</option>
                            <option value="9-12">9‚Äì12h</option>
                            <option value="12-15">12‚Äì15h</option>
                            <option value="15+">15h+</option>
                          </select>
                        </div>
                        <div class="context-row">
                          <label>How many acupressure points did you stimulate (total)?</label>
                          <select name="points_total" required>
                            <option value="">Select number of points</option>
                            <option value="0">0</option>
                            <option value="1-3">1‚Äì3</option>
                            <option value="4-6">4‚Äì6</option>
                            <option value="7-9">7‚Äì9</option>
                            <option value="10-12">10‚Äì12</option>
                          </select>
                        </div>
                        <div class="context-row">
                          <label>How many hours did you sleep during the flight?</label>
                          <select name="sleep_hours">
                            <option value="0">0 hours</option>
                            <option value="1-2">1‚Äì2 hours</option>
                            <option value="3-4">3‚Äì4 hours</option>
                            <option value="5-6">5‚Äì6 hours</option>
                            <option value="7+">7+ hours</option>
                          </select>
                        </div>
                      </form>
                      <h3 style="margin-top: 40px;">Demographics (Optional)</h3>
                      <p>This information helps us understand the diversity of our research participants:</p>
                      <form id="demographicsForm">
                        <div class="demographic-row">
                          <label>Age range</label>
                          <select name="age_range">
                            <option value="lt18">&lt;18</option>
                            <option value="18-24">18‚Äì24</option>
                            <option value="25-34">25‚Äì34</option>
                            <option value="35-44">35‚Äì44</option>
                            <option value="45-54">45‚Äì54</option>
                            <option value="55-64">55‚Äì64</option>
                            <option value="65+">65+</option>
                          </select>
                        </div>
                        <div class="demographic-row">
                          <label>Gender</label>
                          <select name="gender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="nonbinary">Non-binary</option>
                            <option value="notsay">Prefer not to say</option>
                          </select>
                        </div>
                        <div class="demographic-row">
                          <label>Travel experience</label>
                          <select name="travel_experience">
                            <option value="novice">Novice</option>
                            <option value="occasional">Occasional</option>
                            <option value="frequent">Frequent</option>
                            <option value="very_frequent">Very frequent</option>
                          </select>
                        </div>
                        <div class="demographic-row">
                          <label>Geographic region</label>
                          <select name="region">
                            <option value="na">North America</option>
                            <option value="eu">Europe</option>
                            <option value="asia">Asia</option>
                            <option value="oceania">Oceania</option>
                            <option value="africa">Africa</option>
                            <option value="sa">South America</option>
                            <option value="other">Other</option>
                          </select>
                        </div>
                        <div class="demographic-row">
                          <label>Primary travel purpose</label>
                          <select name="purpose">
                            <option value="business">Business</option>
                            <option value="leisure">Leisure</option>
                            <option value="family">Family</option>
                            <option value="other">Other</option>
                          </select>
                        </div>
                      </form>
                        <h3 style="margin-top: 40px;">Additional Comments (Optional)</h3>
                        <p>Your feedback helps improve our research and the JetLagPro app. Please share any additional thoughts about your experience with chronoacupuncture or jet lag management.</p>
                        
                        <div class="comment-container">
                            <label for="userComment">Comments or Feedback:</label>
                            <textarea 
                                id="userComment" 
                                name="userComment" 
                                placeholder="Share your experience, suggestions, or any additional thoughts about chronoacupuncture and jet lag management..."
                                maxlength="1000"
                                rows="4"
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; resize: vertical;"
                            ></textarea>
                            <div class="comment-counter">
                                <span id="commentCharCount">0</span>/1000 characters
                            </div>
                            <div class="comment-note">
                                <small>üí° Your comments are anonymous and will be used for research purposes only.</small>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div style="margin-top: 40px; padding: 30px; text-align: center; border-top: 2px solid #e5e7eb; background: #f9fafb;">
                            <button 
                                id="submitSurveyBtn"
                                onclick="submitSurvey()" 
                                style="
                                    background: #10b981;
                                    color: white;
                                    border: none;
                                    padding: 15px 40px;
                                    border-radius: 8px;
                                    font-size: 18px;
                                    font-weight: bold;
                                    cursor: pointer;
                                    transition: background-color 0.3s ease;
                                "
                                onmouseover="this.style.background='#059669'"
                                onmouseout="this.style.background='#10b981'"
                            >
                                üöÄ Submit Survey
                            </button>
                            <p style="margin-top: 15px; color: #6b7280; font-size: 14px;">
                                Make sure you've entered a valid survey code above before submitting.
                            </p>
                        </div>
                    </div> <!-- End survey-content -->

                    <div class="survey-complete survey-card" id="surveyComplete" style="display: none;">
                        <div class="completion-content">
                            <div class="completion-icon">üéâ</div>
                            <h2>Survey Complete!</h2>
                            <p>Thank you for participating in our research. Your feedback will help improve jet lag management for travelers worldwide.</p>
                            
                            <div class="completion-benefits">
                                <h3>What happens next:</h3>
                                <ul>
                                    <li>‚úÖ Your anonymous data will be analyzed for research purposes</li>
                                    <li>‚úÖ You'll receive free access to the final version of JetLagPro</li>
                                    <li>‚úÖ Research results will be published to advance jet lag science</li>
                                    <li>‚úÖ Your contribution helps future travelers</li>
                                </ul>
                            </div>
                            
                            <div class="completion-actions">
                                <a href="index.html" class="btn btn-primary">Return to JetLagPro</a>
                                <a href="research-paper.html" class="btn btn-secondary" target="_blank">Read Our Research Paper</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 JetLagPro. All rights reserved. | <a href="privacy.html">Privacy Policy</a></p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, doc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBcck2Ca7xBjlZcCwTcQBNQUueFsO0wyBA",
            authDomain: "jetlagpro-research.firebaseapp.com",
            projectId: "jetlagpro-research",
            storageBucket: "jetlagpro-research.firebasestorage.app",
            messagingSenderId: "202766013439",
            appId: "1:202766013439:web:c835e22cf3a12332920dca",
            measurementId: "G-8JV71DX3W3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally for survey.js
        window.firebaseApp = app;
        window.firebaseDB = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseDoc = doc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseServerTimestamp = serverTimestamp;

        console.log('üî• Firebase initialized successfully');
        console.log('üîç Firebase functions check:', {
            firebaseDB: !!window.firebaseDB,
            firebaseCollection: !!window.firebaseCollection,
            firebaseDoc: !!window.firebaseDoc,
            firebaseUpdateDoc: !!window.firebaseUpdateDoc,
            firebaseServerTimestamp: !!window.firebaseServerTimestamp
        });
    </script>
          <script>
          // Eternal cache busting for JavaScript - auto-generates timestamp
          const jsVersion = Math.floor(Date.now() / 1000);
          document.write('<script src="survey.js?v=' + jsVersion + '"><\/script>');
      </script>
    
    <!-- Silent automatic cache refresh script -->
    <script>
        // Silent cache clearing and fresh content loading
        (function() {
            // Silently clear all possible caches
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                });
            }
            
            const expectedVersion = '2025011905';
            const currentVersion = new URLSearchParams(window.location.search).get('cv') || '';
            
            // If no cache version or wrong version, silently reload with cache bust
            if (!currentVersion || currentVersion !== expectedVersion) {
                const url = new URL(window.location);
                url.searchParams.set('cv', expectedVersion);
                url.searchParams.set('_t', Date.now());
                
                // Silent reload
                window.location.replace(url.toString());
                return;
            }
            
            // Silent check - if we don't see expected functions, force reload
            setTimeout(() => {
                if (typeof showMobileAlert === 'undefined') {
                    // Silent hard reload bypassing cache
                    window.location.reload(true);
                }
            }, 1000);
        })();
    </script>
    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
    </script>

    <div id="main-footer"></div>
    
    <!-- Centralized Components (Header/Footer) -->
    <script src="js/components.js"></script>
    
    <!-- Google Translate (Centralized) -->
    <script src="js/translate.js"></script>
</body>
</html> 