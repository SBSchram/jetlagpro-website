<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronoacupuncture Research Paper - JetLagPro</title>
    <script src="load-common-head.js?v=20250912224615"></script>
    <link rel="stylesheet" href="styles.css?v=20250912224615">
    <!-- Add jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js'"></script>
    <!-- Add html2canvas for capturing content -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Chart.js for live data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Note: Word export uses HTML format with embedded images for full compatibility -->
    <style>
        .research-paper {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
            color: #333;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .research-paper h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .research-paper h2 {
            font-size: 1.5rem;  /* 24px - standard academic size */
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .research-paper h3 {
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .research-paper p {
            margin-bottom: 15px;
        }
        
        .abstract {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .keywords {
            font-style: italic;
            margin-top: 15px;
        }
        
        /* Export Button Styling */
        .export-button-container {
            position: fixed;
            top: 120px;
            right: 20px;
            z-index: 1000;
        }
        
        .export-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .export-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
            min-width: 140px;
        }
        
        .export-button:hover {
            background: #1d4ed8;
        }
        
        .export-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .export-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
        }
        
        .export-content a:hover {
            background-color: #f1f1f1;
        }
        
        .export-dropdown:hover .export-content {
            display: block;
        }
        
        .export-dropdown:hover .export-button {
            background: #1d4ed8;
        }
        
        @media (max-width: 768px) {
            .export-button-container {
                position: static;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .export-content {
                position: static;
                display: none;
                margin-top: 10px;
            }
            
            .export-dropdown:hover .export-content {
                display: block;
            }
        }

        @media print {
            /* Hide all webpage elements */
            body * {
                visibility: hidden;
            }
            
            /* Show only the research paper content */
            .research-paper, .research-paper * {
                visibility: visible;
            }
            
            /* Position the research paper at the top */
            .research-paper {
                position: absolute;
                left: 0;
                top: 0;
                max-width: none;
                padding: 0;
                margin: 0;
                width: 100%;
            }
            
            @page {
                margin: 0.75in 0.75in;
                size: letter;
            }
            
            /* Remove top padding for print to respect 1-inch margin */
            main {
                padding-top: 0 !important;
            }
            
            /* Target the specific inline style */
            main[style*="padding-top: 120px"] {
                padding-top: 0 !important;
            }
            
            /* Reset all margins and padding for print */
            body, html {
                margin: 0 !important;
                padding: 0 !important;
            }
            

            
            /* Force title to start at 1-inch margin */
            .research-paper h1 {
                margin-top: 0 !important;
                padding-top: 0 !important;
                position: relative;
                top: 0 !important;
            }
            

            
            /* Hide header and print button when printing */
            #main-header,
            .export-button-container {
                display: none !important;
            }
            
            /* Keep headings with content but allow natural flow */
            .research-paper h1,
            .research-paper h2,
            .research-paper h3 {
                page-break-inside: avoid;
            }
            
            /* Allow paragraphs to break naturally */
            .research-paper p {
                orphans: 2;
                widows: 2;
            }
            
            /* Keep special sections together */
            .research-paper .abstract,
            .research-paper ol,
            .research-paper ul {
                page-break-inside: avoid;
            }
            
            /* Keep survey section headings with their content */
            .research-paper h4 {
                page-break-after: avoid;
                page-break-inside: avoid;
                font-size: 0.75rem !important;
                margin-bottom: 6px !important;
                font-weight: bold;
            }
            
            /* Keep survey sections together */
            .research-paper div[style*="display: grid"] {
                page-break-inside: avoid;
            }
            
            /* Keep headings with following content */
            .research-paper h2,
            .research-paper h3 {
                page-break-after: avoid;
                margin-top: 20px;
                margin-bottom: 10px;
            }
            
            /* Ensure proper spacing for print */
            .research-paper h1 {
                margin-top: 0 !important;
                margin-bottom: 10px;
            }
            
            /* Keep lists together when possible */
            .research-paper ol,
            .research-paper ul {
                page-break-inside: avoid;
            }
            
            /* Ensure adequate space for double-digit list numbers */
            .research-paper ol {
                padding-left: 30px;
            }
            
            /* Abstract styling for print */
            .abstract {
                background: none !important;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
            
            /* Methods section print styling - force images to stay with Methods text */
            .methods-screenshots {
                page-break-inside: avoid;
                page-break-before: auto;
                page-break-after: auto;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Ensure Methods section doesn't start a new page */
            h2:has(+ p + .methods-screenshots) {
                page-break-before: auto;
            }
            
            /* Force Methods section and images to stay together */
            h2:contains("Methods") + p + .methods-screenshots {
                page-break-inside: avoid;
                page-break-before: auto;
                page-break-after: auto;
            }
            
            /* Allow content to extend into margins if needed */
            .methods-screenshots img {
                max-width: 100% !important;
                height: auto !important;
            }
        }
    </style>
</head>
<body>
    <div id="main-header"></div>
    <script>
      fetch('header.html')
        .then(r => r.text())
        .then(html => { document.getElementById('main-header').innerHTML = html; });
    </script>

    <div class="export-button-container">
        <div class="export-dropdown">
            <button class="export-button">Export Paper</button>
            <div class="export-content">
                <a href="#" onclick="exportToPDF()">PDF</a>
                <a href="#" onclick="exportToWord()">Word</a>
                <a href="#" onclick="exportToHTML()">HTML</a>
            </div>
        </div>
    </div>

    <main style="padding-top: 120px;">
        <div class="research-paper">
        <h1>Jet Lag Pro: A Mobile Platform for Evaluating Chronoacupuncture as a Tool for Jet Lag Management</h1>
        
        <p style="text-align: center; margin-bottom: 2px;"><strong>Steven Schram PhD, DC, LAc</strong></p>
        <p style="text-align: center; margin-bottom: 30px;">© 2025 Steven Schram. All rights reserved.</p>
        
        <h2>Abstract</h2>
        <p><strong>Background:</strong> Jet lag affects over 90% of long-haul travelers, and current management strategies including light therapy, melatonin, and sleep scheduling show inconsistent results. Chronoacupuncture, a Traditional Chinese Medicine (TCM) approach involving acupressure stimulation of a specific class of acupuncture points known as horary points at time-specific intervals, has been proposed as a non-pharmacological intervention but has never been systematically evaluated.</p>
        
        <p><strong>Objective:</strong> This pilot study evaluates chronoacupuncture as a potential intervention for jet lag using a mobile health platform, JetLagPro, which guides acupressure stimulation and collects real-world outcome data.</p>
        
        <p><strong>Methods:</strong> Participants used the JetLagPro mobile application to receive timed prompts for self-administered stimulation of horary points aligned with their destination time zone. Following travel, participants completed an online survey to assess resultant symptom severity. That, along with app trip data, was persisted in the survey data.</p>
        
        <p><strong>Outcomes:</strong> We generated preliminary data on effectiveness and symptom reduction across diverse travel conditions. Results provide evidence for whether chronoacupuncture can be effective as a non-photic synchronizer of circadian rhythms.</p>
        
        <p><strong>Significance:</strong> This study is the first systematic investigation of chronoacupuncture for jet lag. Findings will clarify whether chronoacupuncture offers an effective low-cost and non-invasive intervention for travelers.</p>
		
        <p><strong>Keywords:</strong> chronoacupuncture, circadian rhythm, jet lag, horary points, Traditional Chinese Medicine, acupressure</p>

        <h2>Introduction</h2>
        <p>The global increase in air travel has made jet lag a widespread health concern, with economic implications including reduced productivity and increased healthcare costs. Current interventions of light therapy, melatonin, strategic sleeping and varied meal scheduling show variable efficacy. Individual differences in circadian flexibility further complicate treatment approaches.<sup>1</sup></p>

        <p>Acupuncture theory offers an alternative perspective through its understanding of temporal physiology. The Chinese Organ Clock, documented in classical texts dating back millennia, describes a 24-hour cycle where different organ systems reach peak activity during specific two-hour windows. This temporal theory by the ancient sages parallels modern discoveries in circadian biology, where peripheral clocks in organs coordinate with the central circadian pacemaker.</p>

        <p>Chronoacupuncture applies this temporal theory by stimulating specific acupuncture points during their designated active periods. For jet lag applications, we use the destination time zone rather than local time for stimulation scheduling, theoretically facilitating faster circadian adaptation. Despite advocacy and use among acupuncturists, this approach lacks systematic evaluation, representing an information gap between traditional practice and evidence-based medicine.</p>

        <h2>Circadian Biology: Mechanisms of Internal Clocks</h2>
        <p>Circadian rhythms synchronize physiological processes to a 24-26 hour cycle, governed by the suprachiasmatic nucleus (SCN), a hypothalamic cluster of neurons entrained by light via melanopsin containing retinal cells.<sup>2,3</sup> The SCN coordinates peripheral clocks in organs like the liver and heart, which regulate tissue-specific functions including vascular function and blood pressure regulation.<sup>4,5</sup> Core clock genes (Clock, Bmal1, Period, Cryptochrome) drive a molecular feedback loop, producing rhythmic gene expression.<sup>6</sup> Synchronization is maintained by Zeitgebers, external signals such as light, temperature, activity, and meals.<sup>7</sup></p>

        <p>Jet lag occurs when rapid time zone changes desynchronize these clocks, delaying adaptation. Adaptation rates vary widely, underscoring the need for effective interventions. This scientific framework parallels acupuncture's temporal perspective, as embodied in the Chinese Organ Clock, suggesting a synergy between modern circadian biology and traditional acupuncture practices.</p>

        <h2>Acupuncture Theory: A Temporal Understanding</h2>
        <p>Acupuncture theory maps physiological processes to a 24-hour cycle through the Chinese Organ Clock, where vital energy (Qi) flows through 12 meridians, each peaking during a two-hour window.<sup>8</sup> Our focus is on using the horary points, a subset of acupuncture points aligned with the Chinese Organ Clock. These points have an elemental correspondence with their respective meridians (Figure 1) and have a unique resonance with the meridian.</p>

        <p>Over 40 years ago, Khoe and then Amaro postulated that stimulating horary points sequentially during travel could help pre-synchronize our organ systems to new time zones, targeting jet lag's circadian misalignment.<sup>9,10</sup> While jet lag was unknown in ancient times, the time theory of acupuncture meridians was documented and understood in terms of the cyclical nature of all body functions including digestion, activity and rest. This parallels the SCN-driven circadian rhythms described earlier.</p>

        <p>While acupuncturists report using horary points for jet lag for many decades, no studies have validated its efficacy, hence this study. We intend to evaluate chronoacupuncture and quantify the effect of horary point stimulation on jet lag symptoms.</p>

        
		<div style="text-align: center; margin: 30px 0;">
            <img src="assets/images/Wheel-Complex.jpg" alt="Chinese Organ Clock" style="max-width: 50%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <p style="margin-top: 10px; font-style: italic; color: #666;"><strong>Figure 1:</strong> Chinese Organ Clock Visualization</p>
        </div>
		
        <h2>Application of Chronoacupuncture for Jet Lag</h2>
        <p>Chronoacupuncture hypothesizes that stimulating horary points during their peak activity periods acts as a non-photic synchronizer of circadian rhythms with destination time zones. This approach leverages the Chinese Organ Clock and may modulate peripheral clocks via autonomic or hormonal pathways. According to TCM theory, the horary points represent optimal access points along meridians during specific time windows, but the entire meridian pathway remains active during its organ's peak period. Thus approximate stimulation of the general meridian area around the horary point during the correct time window may provide therapeutic benefit even without expert-level point precision.</p>

        <p>A recent comprehensive review validates that acupuncture significantly affects circadian biology, demonstrating measurable impacts on circadian clock genes, neurotransmitter regulation, and sleep-wake cycles (Wu & Zhao, 2024).<sup>11</sup> While these studies employed known acupuncture points known to assist with sleep issues rather than the horary point methodology proposed here, they establish the neurobiological plausibility of acupuncture serving as a non-photic zeitgeber for circadian rhythm modulation.</p>
		
		<h4>A strategic change for KI-10</h4>

		<p>For practical accessibility, we substituted the Kidney Source point KI-3 for the horary point KI-10. In TCM theory, while any point on a meridian can affect the entire pathway, certain point categories have unique efficacy. Horary points excel because of the elemental correspondence with their meridian, while Source points are ideal for tonifying or sedating the corresponding organ. Since KI-10's location behind the knee is difficult to find and stimulate effectively, especially in confined aircraft seating, we selected KI-3 at the medial ankle as an essentially equivalent point but far easier to find and stimulate correctly. This substitution maintains the meridian specificity while optimizing real-world usability.</p>


        <h2>Methods</h2>
		<p>The mobile application provides users with timing and instructions to stimulate specific horary points based on the destination time. Ideally starting at the airport (or anytime thereafter), users select the destination. The app immediately identifies the first active horary point matching the destination time. This process is illustrated below.</p>

		<div class="methods-screenshots" style="text-align: center; margin: 30px 0;">
            <table style="width: 100%; border-collapse: collapse; margin: 0 auto; max-width: 800px;">
                <tr>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <img src="assets/images/research-photo-1.png" alt="JetLagPro App Screenshot 1" style="width: 100%; max-width: 250px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <img src="assets/images/research-photo-2.png" alt="JetLagPro App Screenshot 2" style="width: 100%; max-width: 250px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <img src="assets/images/research-photo-4.png" alt="JetLagPro App Screenshot 4" style="width: 100%; max-width: 250px; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </td>
                </tr>
                <tr>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 8px; font-size: 12px; color: #666; font-weight: bold;">Screen 1: Basic Instructions</p>
                    </td>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 8px; font-size: 12px; color: #666; font-weight: bold;">Screen 2: Destination Selection</p>
                    </td>
                    <td style="width: 33.33%; padding: 10px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 8px; font-size: 12px; color: #666; font-weight: bold;">Screen 3: Point Stimulation</p>
                    </td>
                </tr>
            </table>
        </div>

        <p>Scheduled reminders pop up at appropriate times prompting the user to complete a full 24-hour cycle. The messages are persistent and remain on the user's phone (or watch) until clicked. When clicked, the user is brought to the Points Screen (#3) of the mobile app which displays the correct horary point image beside a looping video showing how to stimulate the point. Written instructions are provided below the images. </p>

        <div style="text-align: center; margin: 30px 0;">
            <h2>Point Images</h2>
            <table style="width: 100%; border-collapse: collapse; margin: 0 auto; max-width: 800px;">
                <tr>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/LU-8.jpg" alt="LU-8 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/LI-1.jpg" alt="LI-1 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/ST-36.jpg" alt="ST-36 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/SP-3.jpg" alt="SP-3 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/HT-8.jpg" alt="HT-8 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/SI-5.jpg" alt="SI-5 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                </tr>
                <tr>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">LU-8</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">LI-1</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">ST-36</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">SP-3</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">HT-8</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">SI-5</p>
                    </td>
                </tr>
                <tr>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/BL-66.jpg" alt="BL-66 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/KI-3.jpg" alt="KI-3 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/PC-8.jpg" alt="PC-8 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/SJ-6.jpg" alt="SJ-6 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/GB-41.jpg" alt="GB-41 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <img src="assets/images/LIV-1.jpg" alt="LIV-1 Point" style="width: 100%; max-width: 80px; height: auto; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    </td>
                </tr>
                <tr>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">BL-66</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">KI-3</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">PC-8</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">SJ-6</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">GB-41</p>
                    </td>
                    <td style="width: 16.67%; padding: 5px; text-align: center; vertical-align: top;">
                        <p style="margin-top: 5px; font-size: 12px; font-weight: bold;">LIV-1</p>
                    </td>
                </tr>
            </table>
        </div>

            <p>After the trip ends, a notification is scheduled for 2 days later to remind the user to complete our website survey. This streamlined assessment was based on the Liverpool Jet Lag Questionnaire's core symptom domains (listed below), using 1-5 severity ranges adapted for real-world mobile use as a single post-travel evaluation.</p> 
			
			<p>Participation was voluntary and anonymous. By completing and submitting the survey, participants provided implicit consent to have their anonymized data used for research purposes, consistent with the privacy disclosure available on the website. </p>
				
			<p>To encourage participation, survey completion unlocked free lifetime use of the application. Access to the survey required a direct link from the app to guarantee authenticity.</p>
			
        <div style="margin: 30px 0 15px 0; background-color: #f8f9fa; border-radius: 8px; padding: 20px;">
            <h2 style="text-align: left;">Data Collected</h2>
            
            <h4>Survey Questions:</h4>
            <ul style="margin-left: 40px; padding-left: 20px; margin-bottom: 20px;">
                <li>Overall anticipated jet lag severity</li>
                <li><strong>Post travel:</strong></li>
                <ul style="margin-left: 20px; margin-bottom: 10px;">
                    <li>Sleep disturbance</li>
                    <li>Daytime fatigue</li>
                    <li>Difficulty concentrating</li>
                    <li>Irritability</li>
					<li>Lack of Motivation/energy</li>
                    <li>Gastrointestinal issues</li>
                </ul>
                <li>Age Range</li>
            </ul>
            
            <h4>Data reported by the app:</h4>
            <ul style="margin-left: 40px; padding-left: 20px; margin-bottom: 10px;">
                <li>Direction of travel</li>
                <li>Number of time zones crossed</li>
                <li>Number of points marked as stimulated</li>
            </ul>
        </div>
		
		<br>
		
        <h2>Data Analysis</h2>
        
        <h4>Primary Research Question</h4>
        <p>Does chronoacupuncture as provided by the app reduce jet lag symptoms as measured by post-travel symptom severity. </p>
		<p>We use a within-subject design where each participant serves as their own control. Participants complete surveys that include two separate elements: (1) anticipated symptom severity based on prior travel experience, and (2) post-travel symptom severity as reported sometime after completing their journey.</p>

	
        <h4>Baseline Data for Time Zones Crossed</h4>
        <p>Our analysis compares survey results to baseline severity data from Waterhouse et al.'s 2007 comprehensive quantitative assessment of jet lag severity stratified by time zones<sup>12</sup>. That study shows non-interventional severity falls into the following ranges.</p>

        <ul style="margin-left: 40px; padding-left: 20px;">
            <li>1-2 time zones: 1.8 severity (1-5 scale)</li>
            <li>3-5 time zones: 2.5 severity (1-5 scale)</li>
            <li>6-8 time zones: 3.1 severity (1-5 scale)</li>
            <li>9+ time zones: 3.6 severity (1-5 scale)</li>
        </ul>	       
<p></p>
					
        <h4>Stimulation Levels</h4>
        <p>Participants are grouped by the number of acupressure points reported by the app as stimulated during travel:</p>                                       
        <ul style="margin-left: 40px; padding-left: 20px;">
            <li>0-2 points (no intervention)</li>
            <li>3-5 points (low stimulation)</li>
            <li>6-8 points (moderate stimulation)</li>
            <li>9-12 points (high stimulation)</li>
        </ul>
		<p></p>

		<p>For each stimulation group, we analyze post-travel symptom severity across different time zone categories to assess how stimulation levels affects the expected symptom increase from crossing more time zones. This grouping provides sufficient sample sizes for statistical analysis while maintaining meaningful intervention categories.</p>
		
<p></p>
        <h4>Dose-Response Analysis Methodology</h4>
        <p>The primary analysis is a comprehensive dose-response visualization showing the interaction between time zones crossed (X-axis) and aggregate symptom severity (Y-axis) across intervention levels. Each intervention group is represented as a separate line, with the baseline data displayed as a dashed reference line showing expected natural progression without intervention. We present two graphs with the following data.</p>
        
        <p>For each data point, we calculate:</p>
        <ul style="margin-left: 40px; padding-left: 20px;">
            <li>Mean aggregate symptom severity across all five measured symptoms</li>
            <li>Standard deviation of symptom severity within each group</li>
            <li>Standard error of the mean for statistical precision</li>
            <li>95% confidence intervals displayed as error bars (±1 SE)</li>
        </ul>
<p></p>
        <h4>Primary and Secondary Analysis</h4>
        <p>The main analysis examines the interaction between time zones crossed and points stimulated on post-travel symptom severity. We will:</p>
        <ul style="margin-left: 40px; padding-left: 20px;">
            <li>Establish the baseline relationship: More time zones = higher post-travel symptoms</li>
            <li>Test the intervention effect: More points stimulated = reduced symptom increase per time zone</li>
            <li>Examine dose-response relationships within each time zone category</li>
            <li>Compare eastward vs. westward travel effects within the stimulation framework</li>
        </ul>
        <p></p>
        <p>Our secondary analyses examines if anticipated vs. actual symptoms show significant differences.</p>

<p></p>		
		<h4>What We Can't Control</h4>
		<p>While acupuncturists are skilled in precise point location and pressure, our typical users are not experts. Some acupressure points may be harder to locate and stimulate correctly during a flight. In real‑world use, users may:</p>
		<ul style="margin-left: 40px; padding-left: 20px;">
			<li>mark a point as stimulated without actually stimulating it,</li>
			<li>stimulate a point ineffectively,</li>
			<li>spend too little time on stimulation,</li>
			<li>use insufficient or excessive pressure,</li>
			<li>stimulate only one side, or</li>
			<li>stimulate a point and forget to mark it as done,</li>
			<li>combine other interventions (e.g., meal/sleep scheduling or melatonin).</li>
		</ul>

		<br>

		<p>We expect and actually welcome this variability. Our question is whether chronoacupressure provides benefit for the average user under real-world conditions. The naturalistic design intentionally captures the intervention as it would be used in practice, including variability in compliance, point location accuracy, and stimulation technique. As stated earlier, TCM theory suggests the entire meridian is active during its peak period, so approximate stimulation during the correct time window should still engage the therapeutic mechanism even if the stimulation was less than ideal.</p> 		

		<h2>Results</h2>
		<h4>The follolowng sections are placeholders!</h4>
		<p>We are waiting on survey results from app usage. App distribution is starting in late October 2025. It may take a few monthy of use to get sufficient data to analyze. The graph does show current live data.</p>
		
		<h4>Palceholder text below</h4>
			p>We analyzed data from [xxx] survey results and stimulation records and present that data in the graph below. We examined how different levels of acupressure stimulation affect jet lag symptoms across time zones crossed. The baseline (dashed gray line) represents expected natural jet lag severity without intervention.</p> 
		
		<div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; border: 1px solid #e5e7eb;">
			<div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-top: 15px; height: 500px; position: relative;">
				<div id="researchChartContainer" style="height: 100%; display: flex; align-items: center; justify-content: center;">
					<div class="loading">Loading live research data...</div>
				</div>
			</div>
			<p style="margin-top: 15px; font-size: 14px; color: #666;">
				<strong>Chart Legend:</strong> Red (0-2 points) = minimal usage, Orange (3-5 points) = low usage, Blue (6-8 points) = moderate usage, Green (9-12 points) = high usage. Error bars show ±1 standard error.
			</p>
		</div>
		
		<p>Currently, we have <span id="dataPointCount">N</span> data points for our graph and analysis. Until we achieve sufficient statistical power (p < 0.05), the results should not be considered statistically significant for reaching conclusions regarding our primary research question.</p>
			
		<h2>Discussion</h2>
        <p>The proposed mechanism for chronoacupuncture involves stimulation of acupressure points triggering afferent nerve pathways that may influence the hypothalamic-pituitary-adrenal axis and autonomic nervous system. This peripheral stimulation could modulate melatonin secretion patterns, cortisol rhythms, and peripheral clock gene expression, effectively serving as a non-photic zeitgeber to accelerate circadian realignment.</p>
		
		<p>This paper presents a prospective observational cohort study that evaluated chronoacupuncture for jet lag management in [XXX] long distance travelers. Participants used the JetLagPro mobile application to self-administer horary point stimulation according to destination time zones and completed a jet lag assessment post-travel. The study design prioritized external validity by evaluating the intervention under real-world conditions rather than controlled laboratory settings. Statistical analysis of the dataset provides evidence regarding chronoacupuncture's effectiveness as a non-pharmacological approach to circadian rhythm adjustment during travel.</p>

        <p>Traditional clinical trials face significant challenges in jet lag research due to the logistical complexity of controlling travel variables, participant demographics, and environmental factors. Our app's naturalistic data collection approach using a well defined survey approach circumvents these limitations while capturing real-world efficacy across diverse travel conditions. However, this methodology introduces potential confounding variables including participant compliance, placebo effects inherent in tactile interventions, and subjective symptom reporting.</p>
		
		<h4>Points or Meridians</h4>
		
		<p>This study evaluates chronoacupuncture's effectiveness for jet lag by stimulating horary points, which are acupuncture points aligned with the Chinese Organ Clock's 24-hour qi cycle. For practicality, we substituted the Kidney horary point KI-10 (behind the knee, hard to locate) with the Kidney Source point KI-3 (medial ankle, more accessible). TCM theory suggests that the entire meridian is active during its peak window (5–7 p.m. for Kidney), so stimulating KI-3 should still engage the meridian's therapeutic potential.</p>
		<p>This substitution raises a key question: does the specific point matter, or is meridian stimulation during the correct time the primary driver of circadian realignment? And if a horary point is difficult for a lay-person to stimulate effectively, would it be better if a more accessible point with similar stimulation value replaced it? And on the contrary side, what would happen if we had a user stimulate points that were 12 hours out of phase with the ideal point. Would the jet lag be worse?</p>
		
		<p>This study does not attempt to answer these questions, but they remain valid questions for future research. Future studies should compare point types (e.g., horary vs. Source) and test stimulation parameters to optimize protocols. By balancing TCM tradition with practical considerations, we may be able to hone an ideal set of points to use for travelers confined to cramped airline seats.</P>

		
        <p>The interdisciplinary framework merging ancient temporal concepts with circadian biology creates a testable hypothesis from traditionally anecdotal practices. If validated, chronoacupuncture could provide a non-invasive, cost-effective intervention accessible to travelers without medical supervision. Negative findings would redirect research toward alternative non-photic zeitgebers and inform the scientific evaluation of other TCM temporal therapies.</p>


        <h2>Summary</h2>
        <p>Chronoacupuncture represents a testable hypothesis merging Traditional Chinese Medicine's horary point theory with contemporary circadian biology. The JetLagPro platform enables systematic evaluation of whether sequential acupressure stimulation can function as a non-photic zeitgeber, potentially modulating circadian rhythms through peripheral nerve pathways and hormonal signaling.</p>

        <p>Success metrics include reduced jet lag symptom severity, accelerated adaptation times, and correlation between compliance and outcomes across diverse travel conditions. Validation would establish an accessible, non-pharmacological intervention for the 90% of long-haul travelers experiencing jet lag. Negative results would inform the scientific assessment of TCM temporal therapies and guide development of alternative circadian interventions.</p>

        <p>This interdisciplinary approach demonstrates how mobile technology can bridge traditional medicine and modern research methodologies, creating scalable platforms for evidence-based evaluation of culturally-rooted health practices in contemporary medical contexts.</p>

        <h2>References</h2>
        <ol>
            <li>Waterhouse, J., Reilly, T., Atkinson, G., & Edwards, B. (2007). Liverpool Jet Lag Questionnaire: validation and baseline data from athletes and travelers. Chronobiology International, 24(6), 1065-1084. <a href="https://doi.org/10.1080/07420520701791505" target="_blank">https://doi.org/10.1080/07420520701791505</a><br>
            <em>Provides baseline severity data from Liverpool Jet Lag Questionnaire administered to athletes and travelers, establishing control reference points for natural jet lag severity without intervention across different time zone transitions (1.8 severity for 1-2 zones, 2.5 for 3-5 zones, 3.1 for 6-8 zones, 3.6 for 9+ zones on 1-5 scale).</em></li>
            
            <li>Panda, S. (2022). Foundations of circadian medicine. PLoS Biology, 20(3), e3001567. <a href="https://doi.org/10.1371/journal.pbio.3001567" target="_blank">https://doi.org/10.1371/journal.pbio.3001567</a><br>
            <em>Comprehensive essay outlining how circadian medicine can exploit mechanisms of circadian physiology and clock-disease interactions for clinical diagnosis, treatment, and prevention, establishing a framework for timing-based medical interventions.</em></li>
            
            <li>Honma, S., & Honma, K.I. (2019). The mammalian circadian timing system and the suprachiasmatic nucleus as its pacemaker. Biology, 8(1), 13. <a href="https://doi.org/10.3390/biology8010013" target="_blank">https://doi.org/10.3390/biology8010013</a><br>
            <em>Comprehensive review of the suprachiasmatic nucleus as the central circadian pacemaker, covering molecular clockwork, neuronal networks, and intercellular communication mechanisms that generate and maintain mammalian circadian rhythms.</em></li>
            
            <li>Paschos, G.K., & FitzGerald, G.A. (2010). Circadian clocks and vascular function. Circulation Research, 106(5), 833-841. <a href="https://doi.org/10.1161/CIRCRESAHA.109.211706" target="_blank">https://doi.org/10.1161/CIRCRESAHA.109.211706</a><br>
            <em>Comprehensive review demonstrating that circadian clocks regulate vascular function through control of blood pressure rhythms, thrombogenesis, endothelial function, and response to vascular injury, based on genetic disruption studies in clock-deficient mice.</em></li>
            
            <li>Hastings, M. H., et al. (2003). A clockwork web: circadian timing in brain and periphery. Nature Reviews Neuroscience, 4(8), 649–661. <a href="https://doi.org/10.1038/nrn1177" target="_blank">https://doi.org/10.1038/nrn1177</a><br>
            <em>Comprehensive review establishing the hierarchical organization of mammalian circadian timing, from the suprachiasmatic nucleus master clock to peripheral tissue oscillators, and demonstrating how clock disruption contributes to disease pathogenesis across multiple physiological systems.</em></li>
            
            <li>Nangle, S. N., Rosensweig, C., Koike, N., Tei, H., Takahashi, J. S., Green, C. B., & Zheng, N. (2014). Molecular assembly of the period-cryptochrome circadian transcriptional repressor complex. eLife, 3, e03674. <a href="https://doi.org/10.7554/eLife.03674" target="_blank">https://doi.org/10.7554/eLife.03674</a><br>
            <em>Crystal structure analysis of the Period-Cryptochrome complex revealing the molecular basis of circadian transcriptional repression, demonstrating how Period and Cryptochrome proteins interact to form the core negative feedback loop that drives mammalian circadian rhythms.</em></li>
            
            <li>Heyde, I., & Oster, H. (2019). Differentiating external zeitgeber impact on peripheral circadian clock resetting. Scientific Reports, 9, 20114. <a href="https://doi.org/10.1038/s41598-019-56323-z" target="_blank">https://doi.org/10.1038/s41598-019-56323-z</a><br>
            <em>Experimental study demonstrating differential effects of light versus food timing on peripheral tissue clocks, showing that zeitgeber desynchrony leads to tissue-specific phase responses and metabolic consequences including cyclic weight changes.</em></li>
            
            <li>Huangdi Neijing (Yellow Emperor's Inner Canon). [Classical text, no online link available]<br>
            <em>Foundational ancient Chinese medical text establishing the theoretical basis for the Chinese Organ Clock, horary point theory, and the circulation of qi through twelve meridians over 24-hour cycles in Traditional Chinese Medicine.</em></li>
            
            <li>Khoe, W.H. (1978). Treatment of jet lag syndrome by acupuncture. American Journal of Acupuncture, 6(2), 135–139.<br>
            <em>Historical paper on acupuncture treatment for jet lag syndrome (content not accessible for detailed summary).</em></li>
            
            <li>Amaro, J. (2001). Time Travel: Contemporary Applications for Jet Lag from Ancient Principles. Acupuncture Today, October 2001. <a href="https://acupuncturetoday.com/article/27861-time-travel-contemporary-applications-for-jet-lag-from-ancient-principles" target="_blank">https://acupuncturetoday.com/article/27861-time-travel-contemporary-applications-for-jet-lag-from-ancient-principles</a><br>
            <em>Practical guide detailing the systematic application of horary points from Traditional Chinese Medicine for jet lag treatment, providing specific protocols for stimulating meridian points based on destination time zones during flight.</em></li>
                        
            <li>Wu, J., & Zhao, Z. (2024). Acupuncture in circadian rhythm sleep–wake disorders and its potential neurochemical mechanisms. Frontiers in Neuroscience, 18, 1346635. <a href="https://doi.org/10.3389/fnins.2024.1346635" target="_blank">https://doi.org/10.3389/fnins.2024.1346635</a><br>
            <em>Comprehensive review demonstrating that acupuncture significantly affects circadian biology through modulation of circadian clock genes (Per1, Per2, Clock, Bmal1), neurotransmitter regulation (5-HT, dopamine, GABA), and melatonin pathways, establishing acupuncture as a non-photic zeitgeber for circadian rhythm disorders.</em></li>
            
            <li>Waterhouse, J., et al. (2007). Jet lag: trends and coping strategies. The Lancet, 369(9567), 1117–1129. <a href="https://doi.org/10.1016/S0140-6736(07)60529-7" target="_blank">https://doi.org/10.1016/S0140-6736(07)60529-7</a><br>
            <em>Reviews jet lag symptoms, causes, and methods to alleviate negative effects of time-zone transitions, including advice for travelers flying in different directions across multiple time zones. It remains the most comprehensive quantitative assessment of jet lag severity stratified by time zones crossed and continues to serve as the reference standard in jet lag research.</em></li>
   
        </ol>
        </div>
    </main>

    <div id="main-footer"></div>
    <script>
      fetch('footer.html')
        .then(r => r.text())
        .then(html => { document.getElementById('main-footer').innerHTML = html; });
    </script>

    <!-- Export Functions -->
    <script>
        // PDF Export Function - Hybrid approach with proper layout handling
        async function exportToPDF() {
            try {
                // Wait for jsPDF to be available (with timeout)
                let attempts = 0;
                const maxAttempts = 10;
                while (!window.jspdf && attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                // Check if jsPDF is available after waiting
                if (!window.jspdf) {
                    throw new Error('jsPDF library failed to load. Please refresh the page and try again.');
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const paperContent = document.querySelector('.research-paper');
                
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border:2px solid #2563eb;border-radius:8px;z-index:9999;';
                loadingDiv.innerHTML = 'Generating PDF with proper layouts... Please wait.';
                document.body.appendChild(loadingDiv);
                
                // Set margins (in mm)
                const margin = 20;
                const bottomMargin = 15;
                const pageWidth = 210 - (2 * margin);
                const pageHeight = 297 - margin - bottomMargin;
                
                doc.setFont('helvetica');
                doc.setFontSize(12);
                doc.setTextColor(51, 51, 51);
                
                let yPosition = margin + 10;
                
                // Helper function to add text
                function addText(text, fontSize = 12, isBold = false, isCentered = false) {
                    if (isBold) doc.setFont('helvetica', 'bold');
                    else doc.setFont('helvetica', 'normal');
                    
                    doc.setFontSize(fontSize);
                    
                    if (isCentered) {
                        const textWidth = doc.getTextWidth(text);
                        const xPosition = (210 - textWidth) / 2;
                        doc.text(text, xPosition, yPosition);
                        yPosition += fontSize * 0.5 + 8;
                    } else {
                        const lines = doc.splitTextToSize(text, pageWidth);
                        for (let line of lines) {
                            if (yPosition > pageHeight) {
                                doc.addPage();
                                yPosition = margin + 10;
                            }
                            doc.text(line, margin, yPosition);
                            yPosition += 6;
                        }
                        yPosition += 8;
                    }
                }
                
                // Helper function to add heading with better spacing
                function addHeading(text, level = 2) {
                    if (yPosition > pageHeight - 30) {
                        doc.addPage();
                        yPosition = margin + 10;
                    }
                    
                    yPosition += level === 1 ? 10 : (level === 2 ? 15 : 10); // Space before heading
                    const fontSize = level === 1 ? 18 : level === 2 ? 16 : 14;
                    addText(text, fontSize, true, level === 1);
                    yPosition += 5; // Space after heading
                }
                
                // Helper function to render complex layouts as images
                async function addLayoutAsImage(element, title = '') {
                    try {
                        if (yPosition > pageHeight - 100) {
                            doc.addPage();
                            yPosition = margin + 10;
                        }
                        
                        if (title) {
                            addText(title, 12, true, true);
                            yPosition += 10;
                        }
                        
                        // Create canvas from element
                        const canvas = await html2canvas(element, {
                            scale: 2,
                            useCORS: true,
                            allowTaint: true,
                            backgroundColor: '#ffffff',
                            width: element.offsetWidth,
                            height: element.offsetHeight
                        });
                        
                        const imgData = canvas.toDataURL('image/png');
                        
                        // Calculate size to fit page width
                        const maxWidth = pageWidth;
                        const imgWidth = Math.min(maxWidth, pageWidth);
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        // Check if image fits on current page
                        if (yPosition + imgHeight > pageHeight) {
                            doc.addPage();
                            yPosition = margin + 10;
                        }
                        
                        // Center the image
                        const xPosition = margin + (pageWidth - imgWidth) / 2;
                        
                        doc.addImage(imgData, 'PNG', xPosition, yPosition, imgWidth, imgHeight);
                        yPosition += imgHeight + 15;
                        
                    } catch (error) {
                        console.warn('Could not render layout as image:', error);
                        addText(`[${title || 'Complex layout'} - content preserved in document]`, 10, true, true);
                        yPosition += 20;
                    }
                }
                
                // Add title and subtitle
                const title = paperContent.querySelector('h1').textContent;
                addHeading(title, 1);
                
                const subtitle = paperContent.querySelector('p[style*="text-align: center"][style*="font-style: italic"]');
                if (subtitle && subtitle.textContent.includes('Pilot Study')) {
                    addText(subtitle.textContent, 12, false, true);
                }
                
                // Process content with special handling for complex layouts
                const elements = Array.from(paperContent.children);
                
                for (let element of elements) {
                    // Skip already processed elements
                    if (element.tagName === 'H1' || 
                        (element.tagName === 'P' && element.style.textAlign === 'center' && element.style.fontStyle === 'italic')) {
                        continue;
                    }
                    
                    // Handle different content types
                    if (element.tagName === 'H2') {
                        addHeading(element.textContent, 2);
                    } else if (element.tagName === 'H3') {
                        addHeading(element.textContent, 3);
                    } else if (element.tagName === 'P') {
                        addText(element.textContent);
                    } else if (element.tagName === 'UL' || element.tagName === 'OL') {
                        const items = Array.from(element.querySelectorAll('li')).map((li, index) => {
                            return element.tagName === 'OL' ? `${index + 1}. ${li.textContent}` : `• ${li.textContent}`;
                        });
                        
                        for (let item of items) {
                            if (yPosition > pageHeight) {
                                doc.addPage();
                                yPosition = margin + 10;
                            }
                            const lines = doc.splitTextToSize(item, pageWidth - 10);
                            for (let line of lines) {
                                doc.text(line, margin + 5, yPosition);
                                yPosition += 6;
                            }
                            yPosition += 2;
                        }
                        yPosition += 10;
                    } else if (element.tagName === 'DIV') {
                        // Special handling for complex divs
                        if (element.querySelector('table')) {
                            // Tables with images - render as image to preserve layout
                            const title = element.querySelector('h3')?.textContent || 'Table with Images';
                            await addLayoutAsImage(element, title);
                        } else if (element.style.display && element.style.display.includes('grid')) {
                            // Grid layouts (like survey questions) - render as image
                            const title = element.querySelector('h2')?.textContent || 'Survey Questions';
                            await addLayoutAsImage(element, title);
                        } else if (element.classList.contains('abstract')) {
                            // Abstract section
                            addText(element.textContent);
                        } else {
                            // Other divs - process text content
                            const textContent = element.textContent.trim();
                            if (textContent) {
                                addText(textContent);
                            }
                        }
                    }
                }
                
                // Save the PDF
                doc.save('JetLagPro_Research_Paper.pdf');
                
                // Remove loading message
                document.body.removeChild(loadingDiv);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again. Error: ' + error.message);
                // Remove loading message if still present
                const loadingDiv = document.querySelector('div[style*="position:fixed"]');
                if (loadingDiv) document.body.removeChild(loadingDiv);
            }
        }
        
        // Word Document Export Function (HTML format with embedded images)
        async function exportToWord() {
            try {
                const paperContent = document.querySelector('.research-paper');
                
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border:2px solid #2563eb;border-radius:8px;z-index:9999;';
                loadingDiv.innerHTML = 'Generating Word document with embedded images... Please wait.';
                document.body.appendChild(loadingDiv);
                
                // Clone the content to modify for Word
                const wordContent = paperContent.cloneNode(true);
                
                // Convert images to base64 for embedding while preserving sizes
                const images = wordContent.querySelectorAll('img');
                for (let img of images) {
                    try {
                        // Capture original styling and dimensions
                        const originalStyle = img.getAttribute('style') || '';
                        const originalWidth = img.getAttribute('width') || '';
                        const originalHeight = img.getAttribute('height') || '';
                        const originalClass = img.getAttribute('class') || '';
                        
                        // Create canvas to convert image to base64
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const tempImg = new Image();
                        
                        // Wait for image to load
                        await new Promise((resolve, reject) => {
                            tempImg.onload = resolve;
                            tempImg.onerror = reject;
                            tempImg.crossOrigin = 'anonymous';
                            tempImg.src = img.src;
                        });
                        
                        // Set canvas size and draw image
                        canvas.width = tempImg.naturalWidth;
                        canvas.height = tempImg.naturalHeight;
                        ctx.drawImage(tempImg, 0, 0);
                        
                        // Convert to base64
                        const base64 = canvas.toDataURL('image/jpeg', 0.8);
                        img.src = base64;
                        
                        // Apply strict size constraints for Word compatibility
                        let finalStyle = '';
                        
                        // Handle different image types with appropriate sizing
                        if (originalClass && originalClass.includes('methods-screenshots')) {
                            // App screenshots - keep smaller for Word
                            finalStyle = 'width: 150px; height: auto; display: inline-block; margin: 5px; border: none;';
                        } else if (img.src.includes('LU-8.jpg') || img.src.includes('LI-1.jpg') || img.src.includes('ST-36.jpg') || 
                                  img.src.includes('SP-3.jpg') || img.src.includes('HT-8.jpg') || img.src.includes('SI-5.jpg') ||
                                  img.src.includes('BL-66.jpg') || img.src.includes('KI-10.jpg') || img.src.includes('PC-8.jpg') ||
                                  img.src.includes('SJ-6.jpg') || img.src.includes('GB-41.jpg') || img.src.includes('LIV-1.jpg')) {
                            // Point images - remove borders and keep very small
                            finalStyle = 'width: 60px; height: auto; display: inline-block; margin: 3px; border: none;';
                        } else if (img.src.includes('Wheel-Complex.jpg')) {
                            // Chinese Organ Clock - moderate size, no border
                            finalStyle = 'width: 300px; height: auto; display: block; margin: 20px auto; border: none;';
                        } else {
                            // Other images - use original size or reasonable default, no border
                            if (originalWidth && originalHeight) {
                                finalStyle = `width: ${Math.min(parseInt(originalWidth), 400)}px; height: auto; display: block; margin: 20px auto; border: none;`;
                            } else {
                                finalStyle = 'width: 300px; height: auto; display: block; margin: 20px auto; border: none;';
                            }
                        }
                        
                        img.setAttribute('style', finalStyle);
                        
                    } catch (error) {
                        console.warn('Could not embed image:', img.src, error);
                        // Keep original src if embedding fails
                    }
                }
                
                // Create Word-compatible HTML with embedded styles and images
                const wordHTML = `<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetLagPro Research Paper</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            font-size: 12pt;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18pt;
            font-weight: bold;
            color: #2c3e50;
        }
        h2 {
            font-size: 14pt;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        h3 {
            font-size: 13pt;
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        .abstract {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #2563eb;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
            border: none;
        }
        /* Preserve 2x2 survey table layout */
        div[style*="grid-template-columns: 1fr 1fr"] {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            grid-template-rows: 1fr 1fr !important;
            gap: 20px !important;
            margin: 20px 0 !important;
        }
        div[style*="border: 1px solid #ddd"] {
            border: 1px solid #ddd !important;
            padding: 20px !important;
            border-radius: 8px !important;
            background: white !important;
        }
        ul, ol {
            margin-bottom: 15px;
            padding-left: 20px;
        }
        li {
            margin-bottom: 5px;
        }
        .methods-screenshots {
            text-align: center;
            margin: 30px 0;
        }
        .methods-screenshots img {
            max-width: 200px;
            margin: 10px;
        }
        /* Word-specific styles */
        @page {
            margin: 1in;
        }
        /* Ensure proper page breaks */
        h1, h2 {
            page-break-after: avoid;
        }
        img {
            page-break-inside: avoid;
        }
    </style>
    <!-- Word-specific meta tags -->
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotHyphenateCaps/>
            <w:PunctuationKerning/>
            <w:DrawingGridHorizontalSpacing>9.35 pt</w:DrawingGridHorizontalSpacing>
            <w:DrawingGridVerticalSpacing>9.35 pt</w:DrawingGridVerticalSpacing>
        </w:WordDocument>
    </xml>
</head>
<body>
${wordContent.outerHTML}
</body>
</html>`;
                
                // Create and download file
                const blob = new Blob([wordHTML], { type: 'application/msword' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'JetLagPro_Research_Paper.doc';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Remove loading message
                document.body.removeChild(loadingDiv);
                
            } catch (error) {
                console.error('Error generating Word document:', error);
                alert('Error generating Word document. Please try again. Error: ' + error.message);
            }
        }
        
        // HTML Export Function with embedded images
        async function exportToHTML() {
            try {
                const paperContent = document.querySelector('.research-paper');
                
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border:2px solid #2563eb;border-radius:8px;z-index:9999;';
                loadingDiv.innerHTML = 'Generating HTML with embedded images... Please wait.';
                document.body.appendChild(loadingDiv);
                
                // Clone content to modify
                const htmlContent = paperContent.cloneNode(true);
                
                // Convert images to base64 for embedding while preserving sizes
                const images = htmlContent.querySelectorAll('img');
                for (let img of images) {
                    try {
                        // Capture original styling and dimensions
                        const originalStyle = img.getAttribute('style') || '';
                        const originalWidth = img.getAttribute('width') || '';
                        const originalHeight = img.getAttribute('height') || '';
                        const originalClass = img.getAttribute('class') || '';
                        
                        // Create canvas to convert image to base64
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const tempImg = new Image();
                        
                        // Wait for image to load
                        await new Promise((resolve, reject) => {
                            tempImg.onload = resolve;
                            tempImg.onerror = reject;
                            tempImg.crossOrigin = 'anonymous';
                            tempImg.src = img.src;
                        });
                        
                        // Set canvas size and draw image
                        canvas.width = tempImg.naturalWidth;
                        canvas.height = tempImg.naturalHeight;
                        ctx.drawImage(tempImg, 0, 0);
                        
                        // Convert to base64
                        const base64 = canvas.toDataURL('image/jpeg', 0.8);
                        img.src = base64;
                        
                        // Restore original styling and dimensions
                        if (originalStyle) img.setAttribute('style', originalStyle);
                        if (originalWidth) img.setAttribute('width', originalWidth);
                        if (originalHeight) img.setAttribute('height', originalHeight);
                        if (originalClass) img.setAttribute('class', originalClass);
                        
                    } catch (error) {
                        console.warn('Could not embed image:', img.src, error);
                        // Keep original src if embedding fails
                    }
                }
                
                // Create complete HTML document
                const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetLagPro Research Paper</title>
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 40px 20px; 
        }
        h1 { text-align: center; margin-bottom: 20px; }
        h2 { font-size: 1.5rem; font-weight: 600; margin-top: 30px; margin-bottom: 15px; color: #2c3e50; }
        h3 { margin-top: 20px; margin-bottom: 10px; }
        p { margin-bottom: 15px; }
        .abstract { background: #f8f9fa; padding: 20px; margin-bottom: 30px; }
        img { 
            max-width: 100%; 
            height: auto; 
            display: block;
            margin: 20px auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .methods-screenshots img {
            max-width: 200px;
            margin: 10px;
        }
        @media print { 
            body { max-width: none; padding: 0; } 
            img { box-shadow: none; }
        }
    </style>
</head>
<body>
${htmlContent.outerHTML}
</body>
</html>`;
                
                // Create download link
                const blob = new Blob([fullHTML], { type: 'text/html' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'JetLagPro_Research_Paper.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Remove loading message
                document.body.removeChild(loadingDiv);
                
            } catch (error) {
                console.error('Error generating HTML:', error);
                alert('Error generating HTML. Please try again. Error: ' + error.message);
            }
        }
        
        // Live Research Data Functions
        let researchChart = null;
        const FIREBASE_REST_URL = "https://firestore.googleapis.com/v1/projects/jetlagpro-research/databases/(default)/documents/tripCompletions";
        
        // Load live research data from Firebase
        async function loadLiveResearchData() {
            try {
                const response = await fetch(FIREBASE_REST_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                let surveyData = [];
                
                if (data.documents && Array.isArray(data.documents)) {
                    data.documents.forEach((document) => {
                        if (document.fields) {
                            const flatData = convertFirestoreDocument(document);
                            if (flatData) {
                                surveyData.push(flatData);
                            }
                        }
                    });
                }
                
                return surveyData;
                
            } catch (error) {
                console.error('Error loading live research data:', error);
                throw new Error('Failed to load live research data: ' + error.message);
            }
        }
        
        // Convert Firestore document format to flat structure
        function convertFirestoreDocument(document) {
            try {
                const fields = document.fields;
                if (!fields) return null;
                
                const extractValue = (fieldName, nestedPath = null) => {
                    const field = fields[fieldName];
                    if (!field) return null;
                    
                    if (nestedPath && field.mapValue && field.mapValue.fields) {
                        const nestedField = field.mapValue.fields[nestedPath];
                        if (nestedField) {
                            if (nestedField.stringValue) return nestedField.stringValue;
                            if (nestedField.integerValue) return parseInt(nestedField.integerValue);
                            if (nestedField.booleanValue !== undefined) return nestedField.booleanValue;
                            if (nestedField.timestampValue) return new Date(nestedField.timestampValue);
                        }
                        return null;
                    }
                    
                    if (field.stringValue) return field.stringValue;
                    if (field.integerValue) return parseInt(field.integerValue);
                    if (field.booleanValue !== undefined) return field.booleanValue;
                    if (field.timestampValue) return new Date(field.timestampValue);
                    
                    return null;
                };
                
                return {
                    id: document.name ? document.name.split('/').pop() : null,
                    surveyCode: extractValue('surveyCode') || extractValue('tripData', 'surveyCode'),
                    tripId: extractValue('tripId') || extractValue('tripData', 'tripId'),
                    platform: extractValue('platform') || extractValue('tripData', 'platform'),
                    destinationCode: extractValue('destinationCode') || extractValue('tripData', 'destinationCode'),
                    timezonesCount: extractValue('timezonesCount') || extractValue('tripData', 'timezonesCount'),
                    travelDirection: extractValue('travelDirection') || extractValue('tripData', 'travelDirection'),
                    pointsCompleted: extractValue('pointsCompleted') || extractValue('tripData', 'pointsCompleted'),
                    completionDate: extractValue('completionDate') || extractValue('tripData', 'completionDate'),
                    surveyCompleted: extractValue('surveyCompleted') || extractValue('surveyData', 'surveyCompleted'),
                    timestamp: extractValue('completionDate') || extractValue('created') || extractValue('tripData', 'completionDate'),
                    
                    // Post-travel symptoms
                    postSleepSeverity: extractValue('sleepPost') || extractValue('surveyData', 'sleepPost'),
                    postFatigueSeverity: extractValue('fatiguePost') || extractValue('surveyData', 'fatiguePost'),
                    postConcentrationSeverity: extractValue('concentrationPost') || extractValue('surveyData', 'concentrationPost'),
                    postIrritabilitySeverity: extractValue('irritabilityPost') || extractValue('surveyData', 'irritabilityPost'),
                    postGISeverity: extractValue('giPost') || extractValue('surveyData', 'giPost'),
                    
                    // Demographics - only age (gender and travel experience removed)
                    age: extractValue('age') || extractValue('ageRange')
                };
                
            } catch (error) {
                console.error('Error converting document:', error);
                return null;
            }
        }
        
        // Render live research chart
        async function renderLiveResearchChart() {
            const container = document.getElementById('researchChartContainer');
            
            try {
                // Show loading
                container.innerHTML = '<div class="loading">Loading live research data...</div>';
                
                // Load data
                const surveyData = await loadLiveResearchData();
                
                if (surveyData.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;"><p>No completed surveys available yet.</p><p>Data will appear here as participants complete their surveys.</p></div>';
                    return;
                }
                
                // Create chart canvas
                container.innerHTML = '<canvas id="liveResearchChart" width="800" height="400"></canvas>';
                
                // Group surveys by app usage levels
                const usageGroups = {
                    '0-2 points': surveyData.filter(s => s.pointsCompleted >= 0 && s.pointsCompleted <= 2),
                    '3-5 points': surveyData.filter(s => s.pointsCompleted >= 3 && s.pointsCompleted <= 5),
                    '6-8 points': surveyData.filter(s => s.pointsCompleted >= 6 && s.pointsCompleted <= 8),
                    '9-12 points': surveyData.filter(s => s.pointsCompleted >= 9 && s.pointsCompleted <= 12)
                };
                
                // Time zone ranges (starting at 2 time zones)
                const timeZoneRanges = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
                
                // Baseline data from Waterhouse study
                const baselineData = [
                    { timeZones: 2, severity: 1.8 },
                    { timeZones: 3, severity: 2.5 },
                    { timeZones: 4, severity: 2.5 },
                    { timeZones: 5, severity: 2.5 },
                    { timeZones: 6, severity: 3.1 },
                    { timeZones: 7, severity: 3.1 },
                    { timeZones: 8, severity: 3.1 },
                    { timeZones: 9, severity: 3.6 },
                    { timeZones: 10, severity: 3.6 },
                    { timeZones: 11, severity: 3.6 },
                    { timeZones: 12, severity: 3.6 }
                ];
                
                // Calculate aggregate severity for each usage group and time zone
                const datasets = [];
                const colors = [
                    { border: '#dc2626', background: 'rgba(220, 38, 38, 0.1)' },
                    { border: '#f59e0b', background: 'rgba(245, 158, 11, 0.1)' },
                    { border: '#3b82f6', background: 'rgba(59, 130, 246, 0.1)' },
                    { border: '#16a34a', background: 'rgba(22, 163, 74, 0.1)' }
                ];
                
                Object.entries(usageGroups).forEach(([groupName, groupSurveys], index) => {
                    const severityData = [];
                    const errorBars = [];
                    
                    timeZoneRanges.forEach(timeZones => {
                        const tzSurveys = groupSurveys.filter(s => s.timezonesCount === timeZones);
                        
                        if (tzSurveys.length > 0) {
                            const aggregateSeverities = tzSurveys.map(survey => {
                                const symptoms = ['postSleepSeverity', 'postFatigueSeverity', 'postConcentrationSeverity', 'postIrritabilitySeverity', 'postMotivationSeverity', 'postGISeverity'];
                                const validSymptoms = symptoms.filter(symptom => survey[symptom] !== null);
                                
                                if (validSymptoms.length > 0) {
                                    return validSymptoms.reduce((sum, symptom) => sum + survey[symptom], 0) / validSymptoms.length;
                                }
                                return null;
                            }).filter(severity => severity !== null);
                            
                            if (aggregateSeverities.length > 0) {
                                const avgSeverity = aggregateSeverities.reduce((sum, severity) => sum + severity, 0) / aggregateSeverities.length;
                                const variance = aggregateSeverities.reduce((sum, severity) => sum + Math.pow(severity - avgSeverity, 2), 0) / aggregateSeverities.length;
                                const stdDev = Math.sqrt(variance);
                                const standardError = stdDev / Math.sqrt(aggregateSeverities.length);
                                
                                severityData.push(avgSeverity);
                                errorBars.push(standardError);
                            } else {
                                severityData.push(null);
                                errorBars.push(null);
                            }
                        } else {
                            severityData.push(null);
                            errorBars.push(null);
                        }
                    });
                    
                    datasets.push({
                        label: `${groupName} (n=${groupSurveys.length})`,
                        data: severityData,
                        borderColor: colors[index].border,
                        backgroundColor: colors[index].background,
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: colors[index].border,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        errorBars: errorBars
                    });
                });
                
                // Add baseline dataset
                const baselineSeverityData = timeZoneRanges.map(tz => {
                    const baselinePoint = baselineData.find(b => b.timeZones === tz);
                    return baselinePoint ? baselinePoint.severity : null;
                });
                
                datasets.push({
                    label: 'Baseline (No Intervention)',
                    data: baselineSeverityData,
                    borderColor: '#6b7280',
                    backgroundColor: 'rgba(107, 114, 128, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.4,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    pointBackgroundColor: '#6b7280',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    errorBars: new Array(timeZoneRanges.length).fill(null)
                });
                
                // Create chart
                const ctx = document.getElementById('liveResearchChart').getContext('2d');
                researchChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeZoneRanges.map(tz => `${tz} TZ`),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Live Dose-Response Analysis: App Usage vs Jet Lag Severity (n=${surveyData.length} completed surveys)`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: function(context) {
                                        return `Time Zones Crossed: ${context[0].label}`;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        const dataset = context.dataset;
                                        const errorBar = dataset.errorBars[context.dataIndex];
                                        
                                        if (value !== null && errorBar !== null) {
                                            return `${dataset.label}: ${value.toFixed(2)} ± ${errorBar.toFixed(2)} severity`;
                                        } else if (value !== null) {
                                            return `${dataset.label}: ${value.toFixed(2)} severity`;
                                        } else {
                                            return `${dataset.label}: No data`;
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time Zones Crossed',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Aggregate Symptom Severity (1-5 scale)',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                min: 1,
                                max: 5,
                                ticks: {
                                    stepSize: 0.5
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    plugins: [{
                        id: 'errorBars',
                        afterDatasetsDraw: function(chart) {
                            const ctx = chart.ctx;
                            const scale = chart.scales.y;
                            
                            chart.data.datasets.forEach((dataset, datasetIndex) => {
                                const meta = chart.getDatasetMeta(datasetIndex);
                                const points = meta.data;
                                
                                points.forEach((point, pointIndex) => {
                                    if (point && dataset.data[pointIndex] !== null && dataset.errorBars[pointIndex] !== null) {
                                        const x = point.x;
                                        const y = point.y;
                                        const errorBar = dataset.errorBars[pointIndex];
                                        
                                        const errorPixels = scale.getPixelForValue(y + errorBar) - scale.getPixelForValue(y);
                                        
                                        ctx.save();
                                        ctx.strokeStyle = dataset.borderColor;
                                        ctx.lineWidth = 2;
                                        ctx.beginPath();
                                        
                                        ctx.moveTo(x, y - errorPixels);
                                        ctx.lineTo(x, y + errorPixels);
                                        
                                        ctx.moveTo(x - 4, y - errorPixels);
                                        ctx.lineTo(x + 4, y - errorPixels);
                                        
                                        ctx.moveTo(x - 4, y + errorPixels);
                                        ctx.lineTo(x + 4, y + errorPixels);
                                        
                                        ctx.stroke();
                                        ctx.restore();
                                    }
                                });
                            });
                        }
                    }, {
                        id: 'refreshButton',
                        afterDraw: function(chart) {
                            // Create refresh button in top left corner
                            const canvas = chart.canvas;
                            const ctx = chart.ctx;
                            const chartArea = chart.chartArea;
                            
                            // Button dimensions and position
                            const buttonWidth = 80;
                            const buttonHeight = 30;
                            const buttonX = chartArea.left + 10;
                            const buttonY = chartArea.top + 10;
                            
                            // Draw button background
                            ctx.save();
                            ctx.fillStyle = '#2563eb';
                            ctx.fillRect(buttonX, buttonY, buttonWidth, buttonHeight);
                            
                            // Draw button text
                            ctx.fillStyle = 'white';
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('Refresh', buttonX + buttonWidth/2, buttonY + buttonHeight/2 + 4);
                            ctx.restore();
                            
                            // Add click handler if not already added
                            if (!canvas.refreshHandlerAdded) {
                                canvas.addEventListener('click', function(event) {
                                    const rect = canvas.getBoundingClientRect();
                                    const x = event.clientX - rect.left;
                                    const y = event.clientY - rect.top;
                                    
                                    // Check if click is within button area
                                    if (x >= buttonX && x <= buttonX + buttonWidth && 
                                        y >= buttonY && y <= buttonY + buttonHeight) {
                                        refreshResearchData();
                                    }
                                });
                                canvas.refreshHandlerAdded = true;
                            }
                        }
                    }]
                });
                
                // Update the data point count in the disclaimer (count actual data points used in chart)
                const dataPointElement = document.getElementById('dataPointCount');
                if (dataPointElement) {
                    // Count surveys that have valid data for the chart (filtered by timezone and valid symptoms)
                    let validDataPoints = 0;
                    Object.values(usageGroups).forEach(groupSurveys => {
                        groupSurveys.forEach(survey => {
                            if (timeZoneRanges.includes(survey.timezonesCount)) {
                                const symptoms = ['postSleepSeverity', 'postFatigueSeverity', 'postConcentrationSeverity', 'postIrritabilitySeverity', 'postGISeverity'];
                                const validSymptoms = symptoms.filter(symptom => survey[symptom] !== null);
                                if (validSymptoms.length > 0) {
                                    validDataPoints++;
                                }
                            }
                        });
                    });
                    dataPointElement.textContent = validDataPoints;
                }
                
            } catch (error) {
                console.error('Error rendering live research chart:', error);
                container.innerHTML = '<div style="text-align: center; color: #dc2626; padding: 40px;"><p>Error loading live data: ' + error.message + '</p><p>Please try refreshing the data.</p></div>';
            }
        }
        
        // Refresh research data function
        async function refreshResearchData() {
            if (researchChart) {
                researchChart.destroy();
            }
            await renderLiveResearchChart();
        }
        
        // Load chart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Small delay to ensure page is fully loaded
            setTimeout(renderLiveResearchChart, 1000);
        });
    </script>

    <!-- Centralized Components (Header/Footer) -->
    <script src="js/components.js"></script>
    
    <!-- Google Translate (Centralized) -->
    <script src="js/translate.js"></script>
</body>
</html>