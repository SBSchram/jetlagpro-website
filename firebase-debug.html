<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug - Explore Collections</title>
    <script src="load-common-head.js?v=20250911094117"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç Firebase Debug - Explore Collections</h1>
    
    <div class="section info">
        <h3>Status</h3>
        <div id="status">Initializing...</div>
    </div>

    <div class="section">
        <h3>Actions</h3>
        <button onclick="listAllCollections()">üìö List All Collections</button>
        <button onclick="checkTripCompletions()">‚úàÔ∏è Check tripCompletions</button>
        <button onclick="checkSurveys()">üìù Check surveys</button>
        <button onclick="checkAnyCollection()">üîç Check Any Collection</button>
    </div>

    <div class="section">
        <h3>Results</h3>
        <div id="results">Click a button above to explore...</div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBcck2Ca7xBjlZcCwTcQBNQUueFsO0wyBA",
            authDomain: "jetlagpro-research.firebaseapp.com",
            projectId: "jetlagpro-research",
            storageBucket: "jetlagpro-research.firebasestorage.app",
            messagingSenderId: "202766013439",
            appId: "1:202766013439:web:c835e22cf3a12332920dca",
            measurementId: "G-8JV71DX3W3"
        };

        let db;

        try {
            console.log('üöÄ Initializing Firebase...');
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            
            document.getElementById('status').innerHTML = '‚úÖ Firebase connected successfully!';
            document.getElementById('status').className = 'section success';
            
        } catch (error) {
            console.error('‚ùå Firebase initialization failed:', error);
            document.getElementById('status').innerHTML = `‚ùå Firebase failed: ${error.message}`;
            document.getElementById('status').className = 'section error';
        }

        // List all collections (this is a best-effort approach)
        window.listAllCollections = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'üîç Attempting to discover collections...';
            
            try {
                // Try common collection names
                const commonCollections = [
                    'tripCompletions', 'surveys', 'trips', 'users', 'data', 
                    'research', 'jetlag', 'completions', 'submissions'
                ];
                
                let foundCollections = [];
                
                for (const colName of commonCollections) {
                    try {
                        console.log(`üîç Checking collection: ${colName}`);
                        const colRef = collection(db, colName);
                        const snapshot = await getDocs(colRef);
                        
                        if (snapshot.size > 0) {
                            foundCollections.push({
                                name: colName,
                                count: snapshot.size,
                                sample: snapshot.docs[0].data()
                            });
                            console.log(`‚úÖ Found collection: ${colName} with ${snapshot.size} documents`);
                        } else {
                            console.log(`‚ÑπÔ∏è Collection ${colName} exists but is empty`);
                        }
                    } catch (error) {
                        console.log(`‚ùå Collection ${colName} not accessible: ${error.message}`);
                    }
                }
                
                if (foundCollections.length > 0) {
                    let html = '<h4>‚úÖ Found Collections:</h4>';
                    foundCollections.forEach(col => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px;">
                                <strong>${col.name}</strong> (${col.count} documents)
                                <details style="margin-top: 10px;">
                                    <summary>Sample Document Structure</summary>
                                    <pre>${JSON.stringify(col.sample, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<h4>‚ùå No accessible collections found</h4><p>Try checking specific collection names below.</p>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<h4>‚ùå Error exploring collections:</h4><pre>${error.message}</pre>`;
            }
        };

        // Check tripCompletions collection specifically
        window.checkTripCompletions = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'üîç Checking tripCompletions collection...';
            
            try {
                const colRef = collection(db, 'tripCompletions');
                const snapshot = await getDocs(colRef);
                
                if (snapshot.size > 0) {
                    let html = `<h4>‚úÖ tripCompletions Collection (${snapshot.size} total documents)</h4>`;
                    html += '<p>Showing all documents:</p>';
                    
                    snapshot.docs.forEach((doc, index) => {
                        const data = doc.data();
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px;">
                                <strong>Document ${index + 1} (ID: ${doc.id})</strong>
                                <details style="margin-top: 10px;">
                                    <summary>Data</summary>
                                    <pre>${JSON.stringify(data, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    });
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<h4>‚ÑπÔ∏è tripCompletions collection exists but is empty</h4>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<h4>‚ùå Error accessing tripCompletions:</h4><pre>${error.message}</pre>`;
            }
        };

        // Check surveys collection specifically
        window.checkSurveys = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'üîç Checking surveys collection...';
            
            try {
                const colRef = collection(db, 'surveys');
                const snapshot = await getDocs(query(colRef, orderBy('timestamp', 'desc'), limit(5)));
                
                if (snapshot.size > 0) {
                    let html = `<h4>‚úÖ surveys Collection (${snapshot.size} total documents)</h4>`;
                    html += '<p>Showing last 5 documents:</p>';
                    
                    snapshot.docs.forEach((doc, index) => {
                        const data = doc.data();
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px;">
                                <strong>Document ${index + 1} (ID: ${doc.id})</strong>
                                <details style="margin-top: 10px;">
                                    <summary>Data</summary>
                                    <pre>${JSON.stringify(data, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    });
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<h4>‚ÑπÔ∏è surveys collection exists but is empty</h4>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<h4>‚ùå Error accessing surveys:</h4><pre>${error.message}</pre>`;
            }
        };

        // Check any collection by name
        window.checkAnyCollection = async function() {
            const colName = prompt('Enter collection name to check:');
            if (!colName) return;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `üîç Checking ${colName} collection...`;
            
            try {
                const colRef = collection(db, colName);
                const snapshot = await getDocs(query(colRef, limit(5)));
                
                if (snapshot.size > 0) {
                    let html = `<h4>‚úÖ ${colName} Collection (${snapshot.size} total documents)</h4>`;
                    html += '<p>Showing first 5 documents:</p>';
                    
                    snapshot.docs.forEach((doc, index) => {
                        const data = doc.data();
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px;">
                                <strong>Document ${index + 1} (ID: ${doc.id})</strong>
                                <details style="margin-top: 10px;">
                                    <summary>Data</summary>
                                    <pre>${JSON.stringify(data, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    });
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `<h4>‚ÑπÔ∏è ${colName} collection exists but is empty</h4>`;
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<h4>‚ùå Error accessing ${colName}:</h4><pre>${error.message}</pre>`;
            }
        };
    </script>
</body>
</html>
