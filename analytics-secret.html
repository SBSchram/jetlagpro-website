<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetLagPro Analytics Dashboard</title>
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="JetLagPro Research Data Analytics">
    <script src="load-common-head.js?v=20250912224615"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- External CSS and JavaScript files -->
    <link rel="stylesheet" href="assets/css/analytics.css">
    <script src="assets/js/analytics.js"></script>
    <script src="assets/js/charts.js"></script>
    
    <script>
        // Inline JavaScript removed - now using external files:
        // - analytics.js: Main dashboard functionality
        // - charts.js: Chart rendering functions
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä JetLagPro Analytics Dashboard</h1>
            <p>Research Data Analysis & Insights (REST API)</p>
        </div>

        <button class="refresh-btn" onclick="refreshData()">
            üîÑ Refresh Data
        </button>



        <div class="data-section">
            <h2><span class="icon">üî¨</span>Stimulation Efficacy Analysis</h2>
            <div id="stimulationEfficacy" class="loading">Loading efficacy data...</div>
        </div>

        <div class="data-section">
            <h2><span class="icon">üìà</span>Advanced Research Analytics</h2>
            <div id="advancedAnalytics" class="loading">Loading advanced analytics...</div>
        </div>

        <div class="data-section">
            <h2><span class="icon">üîç</span>Custom Data Analysis</h2>
            <div id="sqlBuilder" class="sql-builder">
                <div class="query-builder">
                    <h3>Build Your Query</h3>
                    
                                         <div class="query-section">
                         <label>Select Fields:</label>
                         <div class="field-selector">
                             <div class="select-all-controls">
                                 <button type="button" onclick="selectAllFields()" class="select-all-btn">Select All (Excluding Points 1-12)</button>
                                 <button type="button" onclick="clearAllFields()" class="clear-all-btn">Clear All</button>
                             </div>
                             
                             <h4>Basic Trip Info</h4>
                             <label><input type="checkbox" value="tripId" checked> Trip ID</label>
                             <label><input type="checkbox" value="surveyCode" checked> Survey Code</label>
                             <label><input type="checkbox" value="destinationCode"> Destination</label>
                             <label><input type="checkbox" value="startDate"> Start Date</label>
                             <label><input type="checkbox" value="completionDate"> Completion Date</label>
                             
                             <h4>Travel Details</h4>
                             <label><input type="checkbox" value="travelDirection"> Travel Direction</label>
                             <label><input type="checkbox" value="timezonesCount"> Timezones Count</label>
                             <label><input type="checkbox" value="direction"> Direction</label>
                             <label><input type="checkbox" value="purpose"> Purpose</label>
                             <label><input type="checkbox" value="travelExperience"> Travel Experience</label>
                             <label><input type="checkbox" value="flightDuration"> Flight Duration</label>
                             <label><input type="checkbox" value="flightLandingDate"> Flight Landing Date</label>
                             <label><input type="checkbox" value="flightLandingHour"> Flight Landing Hour</label>
                             

                             
                             <h4>Survey Results</h4>
                             <label><input type="checkbox" value="surveyCompleted"> Survey Completed</label>
                             <label><input type="checkbox" value="surveyVersion"> Survey Version</label>
                             <label><input type="checkbox" value="age"> Age</label>
                             <label><input type="checkbox" value="gender"> Gender</label>
                             <label><input type="checkbox" value="region"> Region</label>
                             
                             <!-- Baseline symptoms removed from survey - now focusing on anticipated vs post-travel -->
                             
                             <h4>Post-Travel Symptoms</h4>
                             <label><input type="checkbox" value="postSleepSeverity"> Post Sleep Severity</label>
                             <label><input type="checkbox" value="postFatigueSeverity"> Post Fatigue Severity</label>
                             <label><input type="checkbox" value="postConcentrationSeverity"> Post Concentration Severity</label>
                             <label><input type="checkbox" value="postIrritabilitySeverity"> Post Irritability Severity</label>
                             <label><input type="checkbox" value="postGiSeverity"> Post GI Severity</label>
                             
                             <h4>Anticipated Symptoms</h4>
                             <label><input type="checkbox" value="anticipatedSleepSeverity"> Anticipated Sleep Severity</label>
                             <label><input type="checkbox" value="anticipatedFatigueSeverity"> Anticipated Fatigue Severity</label>
                             <label><input type="checkbox" value="anticipatedConcentrationSeverity"> Anticipated Concentration Severity</label>
                             <label><input type="checkbox" value="anticipatedIrritabilitySeverity"> Anticipated Irritability Severity</label>
                             <label><input type="checkbox" value="anticipatedGiSeverity"> Anticipated GI Severity</label>
                             
                             <label><input type="checkbox" value="completionMethod"> Completion Method</label>
                                                       </div>
                      </div>

                    <div class="query-section">
                        <label>Filter Data:</label>
                        <div class="filter-builder">
                            <select id="filterField">
                                <option value="platform">Platform</option>
                                <option value="travelDirection">Travel Direction</option>
                                <option value="timezonesCount">Timezones Count</option>
                                <option value="pointsCompleted">Points Completed</option>
                                <option value="surveyCompleted">Survey Completed</option>
                                <option value="age">Age</option>
                                <option value="gender">Gender</option>
                                <option value="region">Region</option>
                                <option value="purpose">Purpose</option>
                                <option value="travelExperience">Travel Experience</option>
                                <option value="destinationCode">Destination</option>
                                <option value="surveyVersion">Survey Version</option>
                                <option value="completionMethod">Completion Method</option>
                            </select>
                            <select id="filterOperator">
                                <option value="equals">Equals</option>
                                <option value="notEquals">Not Equals</option>
                                <option value="greaterThan">Greater Than</option>
                                <option value="lessThan">Less Than</option>
                                <option value="contains">Contains</option>
                            </select>
                            <input type="text" id="filterValue" placeholder="Value">
                            <button onclick="addFilter()" class="filter-btn">Add Filter</button>
                        </div>
                        <div id="activeFilters" class="active-filters"></div>
                    </div>

                    <div class="query-section">
                        <label>Group By:</label>
                        <select id="groupByField">
                            <option value="">No Grouping</option>
                            <option value="platform">Platform</option>
                            <option value="travelDirection">Travel Direction</option>
                            <option value="timezonesCount">Timezones Count</option>
                            <option value="pointsCompleted">Points Completed</option>
                            <option value="age">Age</option>
                            <option value="gender">Gender</option>
                            <option value="region">Region</option>
                            <option value="purpose">Purpose</option>
                            <option value="travelExperience">Travel Experience</option>
                            <option value="destinationCode">Destination</option>
                            <option value="surveyVersion">Survey Version</option>
                        </select>
                    </div>

                    <div class="query-section">
                        <label>Aggregate:</label>
                        <div class="aggregate-selector">
                            <label><input type="checkbox" value="count"> Count</label>
                            <label><input type="checkbox" value="avg"> Average</label>
                            <label><input type="checkbox" value="sum"> Sum</label>
                            <label><input type="checkbox" value="min"> Min</label>
                            <label><input type="checkbox" value="max"> Max</label>
                        </div>
                    </div>

                                         <div class="query-section">
                         <button onclick="executeQuery()" class="execute-btn">üöÄ Execute Query</button>
                         <button onclick="exportResults()" class="export-btn">üìä Export CSV</button>
                     </div>

                     <div class="query-section">
                         <label>Pre-built Research Queries:</label>
                         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                             <button onclick="runPrebuiltQuery('stimulation-efficacy')" class="prebuilt-btn">üî¨ Stimulation Efficacy</button>
                             <button onclick="runPrebuiltQuery('timezone-effect')" class="prebuilt-btn">üåç Time Zone Effect</button>
                             <button onclick="runPrebuiltQuery('travel-direction')" class="prebuilt-btn">üß≠ Travel Direction</button>
                             <button onclick="runPrebuiltQuery('dose-response')" class="prebuilt-btn">üìà Dose-Response Curve</button>
                             <button onclick="runPrebuiltQuery('symptom-comparison')" class="prebuilt-btn">‚öñÔ∏è Symptom Comparison</button>
                         </div>
                     </div>
                </div>

                <div class="query-results">
                    <h3>Query Results</h3>
                    <div id="queryResults" class="results-display">
                        <p>Build and execute a query to see results here.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="data-section">
            <h2><span class="icon">üìä</span>Trip Completion Analysis</h2>
            <div id="symptomAnalysis" class="loading">Loading trip data...</div>
        </div>

        <div class="data-section">
            <h2><span class="icon">üïí</span>Recent Submissions</h2>
            <div id="recentSubmissions" class="loading">Loading recent data...</div>
        </div>
    </div>
</body>
</html>
